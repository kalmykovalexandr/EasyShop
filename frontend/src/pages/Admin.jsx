import React, { useEffect, useState } from 'react'
import { api } from '../lib/api'
export default function Admin(){const [list,setList]=useState([]); async function load(){ try{ const l = await api('/products'); setList(l) } catch(e){ alert(e.message) } } useEffect(()=>{ load() },[])
  async function create(e){ e.preventDefault(); const data = { name:e.target.name.value, description:e.target.description.value, price:Number(e.target.price.value), stock:Number(e.target.stock.value) }; try{ await api('/admin/products',{ method:'POST', body:JSON.stringify(data) }); e.target.reset(); load() } catch(e){ alert(e.message) } }
  async function del(id){ if(!confirm('Удалить?')) return; try{ await api('/admin/products/'+id,{ method:'DELETE' }); load() } catch(e){ alert(e.message) } }
  return (<div><div style={{border:'1px solid #eee',borderRadius:14,padding:16, marginBottom:16}}><h2>Создать товар</h2><form onSubmit={create}><input name="name" placeholder="Название" required/> <input name="price" type="number" step="0.01" defaultValue="0"/> <input name="stock" type="number" defaultValue="0"/><br/><br/><textarea name="description" placeholder="Описание" rows="3" style={{width:'100%'}}></textarea><br/><br/><button>Создать</button></form></div><div style={{border:'1px solid #eee',borderRadius:14,padding:16}}><h2>Каталог</h2><table style={{width:'100%',borderCollapse:'collapse'}}><thead><tr><th>Название</th><th>Цена</th><th>Сток</th><th></th></tr></thead><tbody>{list.map(p=>(<tr key={p.id}><td>{p.name}</td><td>{Number(p.price).toFixed(2)} ₽</td><td>{p.stock}</td><td style={{textAlign:'right'}}><button onClick={()=>del(p.id)}>Удалить</button></td></tr>))}</tbody></table></div></div>) }
